# Phase 3: è®°å¿†å’Œä¸€è‡´æ€§ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

Phase 3 å®ç°äº†å®Œæ•´çš„è®°å¿†ç³»ç»Ÿä¸ä¸€è‡´æ€§éªŒè¯æµç¨‹ï¼Œå°†æ‰€æœ‰åŠŸèƒ½æ•´åˆåˆ°ç»Ÿä¸€çš„ç”Ÿæˆç®¡é“ä¸­ã€‚

### âœ… å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

1. **MemoryIntegrationService** - è®°å¿†é›†æˆæœåŠ¡
   - è‡ªåŠ¨æ£€ç´¢ç›¸å…³è®°å¿†
   - å°†è®°å¿†æ³¨å…¥åˆ°ç”Ÿæˆæç¤ºè¯
   - ä»ç”Ÿæˆå†…å®¹ä¸­æå–å¹¶åˆ›å»ºæ–°è®°å¿†

2. **GenerationPipeline** - ç»Ÿä¸€ç”Ÿæˆç®¡é“
   - AIå†…å®¹ç”Ÿæˆ
   - è§’è‰²ä¸€è‡´æ€§éªŒè¯
   - ä¸–ç•Œè§‚ä¸€è‡´æ€§éªŒè¯
   - è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆéªŒè¯å¤±è´¥æ—¶ï¼‰

3. **StoryGenerationController** - REST API
   - ç»Ÿä¸€çš„ç”Ÿæˆæ¥å£
   - å¤šç§å†…å®¹ç±»å‹æ”¯æŒï¼ˆç« èŠ‚ã€å¯¹è¯ã€åœºæ™¯ã€å†…å¿ƒç‹¬ç™½ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. API ç«¯ç‚¹

**åŸºç¡€URL**: `http://localhost:8080/api/generation`

**ä¸»è¦ç«¯ç‚¹**:
- `POST /execute` - æ‰§è¡Œå®Œæ•´ç”Ÿæˆæµç¨‹ï¼ˆæ¨èï¼‰
- `POST /chapter` - ç”Ÿæˆç« èŠ‚ï¼ˆç®€åŒ–æ¥å£ï¼‰
- `POST /dialogue` - ç”Ÿæˆå¯¹è¯
- `POST /scene` - ç”Ÿæˆåœºæ™¯
- `POST /monologue` - ç”Ÿæˆå†…å¿ƒç‹¬ç™½
- `POST /quick-test` - å¿«é€Ÿæµ‹è¯•ï¼ˆä¸éªŒè¯ã€ä¸åˆ›å»ºè®°å¿†ï¼‰

---

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç”Ÿæˆå®Œæ•´ç« èŠ‚ï¼ˆå¸¦è®°å¿†å’ŒéªŒè¯ï¼‰

```bash
curl -X POST http://localhost:8080/api/generation/chapter \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "projectId=550e8400-e29b-41d4-a716-446655440001" \
  -d "characterIds=550e8400-e29b-41d4-a716-446655440002" \
  -d "characterIds=550e8400-e29b-41d4-a716-446655440003" \
  -d "worldviewId=550e8400-e29b-41d4-a716-446655440004" \
  -d "sceneContext=ä¸¤ä½ä¸»è§’åœ¨åºŸå¼ƒå·¥å‚ä¸­é­é‡çªè¢­" \
  -d "generationGoal=ç´§å¼ åˆºæ¿€,å±•ç°è§’è‰²æ€§æ ¼"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "generatedContent": "ç”Ÿæˆçš„ç« èŠ‚å†…å®¹...",
    "success": true,
    "generatedAt": "2025-10-29T10:30:00",
    "passedAllValidation": true,
    "retryCount": 0,
    "memoriesUsed": 8,
    "newMemoryIds": [
      "uuid-1",
      "uuid-2"
    ],
    "characterConsistencyResults": [
      {
        "overallScore": 0.85,
        "passed": true,
        "violations": []
      }
    ],
    "worldviewConsistencyResult": {
      "overallScore": 0.90,
      "passed": true,
      "violations": []
    },
    "durationMs": 3500,
    "logs": [
      "[2025-10-29T10:30:00] å¼€å§‹ç”Ÿæˆæµç¨‹",
      "[2025-10-29T10:30:01] æ£€ç´¢åˆ° 8 æ¡ç›¸å…³è®°å¿†",
      "[2025-10-29T10:30:03] ç”Ÿæˆå†…å®¹é•¿åº¦: 1200 å­—ç¬¦",
      "[2025-10-29T10:30:03] è§’è‰² å¼ ä¸‰ éªŒè¯é€šè¿‡ (å¾—åˆ†: 0.85)",
      "[2025-10-29T10:30:03] ä¸–ç•Œè§‚éªŒè¯é€šè¿‡ (å¾—åˆ†: 0.90)",
      "[2025-10-29T10:30:03] æˆåŠŸåˆ›å»º 2 æ¡æ–°è®°å¿†",
      "[2025-10-29T10:30:03] ç”Ÿæˆæµç¨‹å®Œæˆï¼Œæ€»è€—æ—¶: 3500ms"
    ]
  }
}
```

---

### ç¤ºä¾‹ 2: ä½¿ç”¨å®Œæ•´ GenerationRequest

```bash
curl -X POST http://localhost:8080/api/generation/execute \
  -H "Content-Type: application/json" \
  -d '{
    "projectId": "550e8400-e29b-41d4-a716-446655440001",
    "worldviewId": "550e8400-e29b-41d4-a716-446655440004",
    "characterIds": [
      "550e8400-e29b-41d4-a716-446655440002",
      "550e8400-e29b-41d4-a716-446655440003"
    ],
    "contentType": "DIALOGUE",
    "sceneContext": "å¤œæ™šï¼ŒåºŸå¼ƒå·¥å‚çš„å¤©å°ä¸Šï¼Œä¸¤äººå¯¹å³™",
    "emotionalTone": "ç´§å¼ ã€å¯¹æŠ—",
    "generationGoal": "ä¸¤äººå› ç«‹åœºä¸åŒäº§ç”Ÿæ¿€çƒˆäº‰æ‰§ï¼Œä½†å†…å¿ƒéƒ½ä¸æƒ³ä¼¤å®³å¯¹æ–¹",
    "enableMemory": true,
    "memoryCount": 5,
    "enableConsistencyCheck": true,
    "maxRetries": 2,
    "temperature": 0.9,
    "maxTokens": 1500,
    "autoCreateMemory": true
  }'
```

---

### ç¤ºä¾‹ 3: å¿«é€Ÿæµ‹è¯•ï¼ˆä¸éªŒè¯ï¼‰

ç”¨äºå¿«é€ŸæŸ¥çœ‹ç”Ÿæˆæ•ˆæœï¼Œè·³è¿‡éªŒè¯å’Œè®°å¿†åˆ›å»ºï¼š

```bash
curl -X POST http://localhost:8080/api/generation/quick-test \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "projectId=550e8400-e29b-41d4-a716-446655440001" \
  -d "characterIds=550e8400-e29b-41d4-a716-446655440002" \
  -d "prompt=æå†™ä¸»è§’åœ¨æ¸…æ™¨é†’æ¥æ—¶çš„å¿ƒæƒ…"
```

---

## ğŸ”§ æ ¸å¿ƒå‚æ•°è¯´æ˜

### GenerationRequest å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| projectId | UUID | âœ… | - | é¡¹ç›®ID |
| characterIds | List<UUID> | âœ… | - | å‚ä¸è§’è‰²IDåˆ—è¡¨ |
| contentType | ContentType | âœ… | - | å†…å®¹ç±»å‹ |
| worldviewId | UUID | âŒ | null | ä¸–ç•Œè§‚ID |
| sceneContext | String | âŒ | - | åœºæ™¯æè¿°/ä¸Šä¸‹æ–‡ |
| emotionalTone | String | âŒ | - | æƒ…æ„ŸåŸºè°ƒ |
| generationGoal | String | âŒ | - | ç”Ÿæˆç›®æ ‡/è¦æ±‚ |
| previousContent | String | âŒ | - | å‰æ–‡å†…å®¹ |
| enableMemory | Boolean | âŒ | true | æ˜¯å¦å¯ç”¨è®°å¿†æ£€ç´¢ |
| memoryCount | Integer | âŒ | 5 | æ¯ä¸ªè§’è‰²æ£€ç´¢çš„è®°å¿†æ•°é‡ |
| enableConsistencyCheck | Boolean | âŒ | true | æ˜¯å¦è¿›è¡Œä¸€è‡´æ€§éªŒè¯ |
| maxRetries | Integer | âŒ | 2 | æœ€å¤§é‡è¯•æ¬¡æ•° |
| temperature | Double | âŒ | 0.8 | AIæ¸©åº¦å‚æ•°ï¼ˆåˆ›æ„æ€§ï¼‰ |
| maxTokens | Integer | âŒ | 2000 | æœ€å¤§ç”Ÿæˆtokenæ•° |
| autoCreateMemory | Boolean | âŒ | true | æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè®°å¿† |
| timelineId | UUID | âŒ | null | æ—¶é—´çº¿ID |

### ContentType æšä¸¾

- `CHAPTER` - ç« èŠ‚
- `DIALOGUE` - å¯¹è¯
- `SCENE` - åœºæ™¯æå†™
- `INNER_MONOLOGUE` - å†…å¿ƒç‹¬ç™½
- `NARRATIVE` - å™è¿°
- `ACTION` - è¡ŒåŠ¨
- `CHARACTER` - è§’è‰²è®¾å®š
- `WORLDVIEW` - ä¸–ç•Œè§‚

---

## ğŸ§  è®°å¿†ç³»ç»Ÿå·¥ä½œæµç¨‹

### 1. è®°å¿†æ£€ç´¢æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ç”Ÿæˆ
    â†“
æ£€ç´¢æ¯ä¸ªè§’è‰²çš„ç›¸å…³è®°å¿†
    â†“
æ ¹æ®åœºæ™¯ä¸Šä¸‹æ–‡ã€æƒ…æ„ŸåŸºè°ƒè®¡ç®—ç›¸å…³æ€§
    â†“
é€‰æ‹©å‰Næ¡æœ€ç›¸å…³çš„è®°å¿†
    â†“
æ›´æ–°è®°å¿†çš„è®¿é—®è®°å½•ï¼ˆé—å¿˜æ›²çº¿ï¼‰
    â†“
æ³¨å…¥åˆ°ç”Ÿæˆæç¤ºè¯
```

### 2. è®°å¿†åˆ›å»ºæµç¨‹

```
AIç”Ÿæˆå†…å®¹
    â†“
ä½¿ç”¨AIåˆ†æå†…å®¹ï¼Œæå–å…³é”®äº‹ä»¶
    â†“
è§£ææå–ç»“æœï¼ˆè§’è‰²|ç±»å‹|å†…å®¹|æƒé‡|å…³é”®è¯ï¼‰
    â†“
ä¸ºæ¯ä¸ªè§’è‰²åˆ›å»ºCharacterMemory
    â†“
ä¿å­˜åˆ°æ•°æ®åº“
    â†“
è¿”å›æ–°è®°å¿†IDåˆ—è¡¨
```

### 3. è®°å¿†ç›¸å…³æ€§è®¡ç®—

```
ç›¸å…³æ€§å¾—åˆ† =
  å…³é”®è¯åŒ¹é…åº¦ Ã— 30% +
  æƒ…æ„Ÿå…±é¸£åº¦ Ã— 20% +
  è®°å¿†å¯è®¿é—®æ€§ Ã— 30% +
  é‡è¦æ€§æƒé‡ Ã— 20%
```

---

## âœ… ä¸€è‡´æ€§éªŒè¯æµç¨‹

### éªŒè¯ç®¡é“

```
ç”Ÿæˆå†…å®¹
    â†“
è§’è‰²ä¸€è‡´æ€§éªŒè¯
    â”œâ”€ æ€§æ ¼å‘é‡åŒ¹é…
    â”œâ”€ è¯­è¨€æ¨¡å¼éªŒè¯
    â”œâ”€ è¡Œä¸ºä¹ æƒ¯æ£€æŸ¥
    â””â”€ æ€§æ ¼ç‰¹å¾æ£€æŸ¥
    â†“
ä¸–ç•Œè§‚ä¸€è‡´æ€§éªŒè¯
    â”œâ”€ è§„åˆ™éµå®ˆæ£€æŸ¥
    â”œâ”€ çº¦æŸæ¡ä»¶éªŒè¯
    â”œâ”€ ç‰©ç†è§„å¾‹éªŒè¯
    â””â”€ æœ¯è¯­ä½¿ç”¨æ£€æŸ¥
    â†“
æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ è¿”å›å†…å®¹
    â””â”€ å¦ â†’ æ³¨å…¥åé¦ˆ â†’ é‡æ–°ç”Ÿæˆï¼ˆæœ€å¤šNæ¬¡ï¼‰
```

### éªŒè¯ç»“æœç¤ºä¾‹

```json
{
  "characterConsistencyResults": [
    {
      "overallScore": 0.75,
      "vectorScore": 0.80,
      "speechPatternValid": true,
      "behaviorPatternValid": true,
      "violations": [
        "å‹‡æ•¢çš„è§’è‰²ä¸åº”è¡¨ç°å‡ºè¿‡åº¦èƒ†æ€¯"
      ],
      "passed": false,
      "aiSuggestions": "å»ºè®®ä¿®æ”¹..."
    }
  ],
  "worldviewConsistencyResult": {
    "overallScore": 0.90,
    "violations": [],
    "passed": true
  }
}
```

---

## ğŸ“Š å®Œæ•´æµç¨‹ç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GenerationPipeline                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ„å»ºç”Ÿæˆä¸Šä¸‹æ–‡ï¼ˆMemoryIntegrationServiceï¼‰              â”‚
â”‚     â”œâ”€ åŠ è½½é¡¹ç›®ã€è§’è‰²ã€ä¸–ç•Œè§‚                                â”‚
â”‚     â”œâ”€ æ£€ç´¢ç›¸å…³è®°å¿†ï¼ˆCharacterMemoryEnhancedServiceï¼‰       â”‚
â”‚     â””â”€ æ„å»ºå®Œæ•´ä¸Šä¸‹æ–‡å¯¹è±¡                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ„å»ºå¢å¼ºæç¤ºè¯                                           â”‚
â”‚     â”œâ”€ åŸºç¡€æç¤ºè¯ï¼ˆæ ¹æ®å†…å®¹ç±»å‹ï¼‰                            â”‚
â”‚     â”œâ”€ æ³¨å…¥ä¸–ç•Œè§‚ä¿¡æ¯                                        â”‚
â”‚     â”œâ”€ æ³¨å…¥è§’è‰²ä¿¡æ¯å’Œè®°å¿†                                    â”‚
â”‚     â””â”€ æ³¨å…¥åœºæ™¯å’Œæƒ…æ„ŸåŸºè°ƒ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. AIç”Ÿæˆå†…å®¹ï¼ˆAiGenerationServiceï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ä¸€è‡´æ€§éªŒè¯                                               â”‚
â”‚     â”œâ”€ è§’è‰²éªŒè¯ï¼ˆCharacterConsistencyValidatorï¼‰            â”‚
â”‚     â””â”€ ä¸–ç•Œè§‚éªŒè¯ï¼ˆWorldviewConsistencyValidatorï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    éªŒè¯é€šè¿‡ï¼Ÿ
                   â•±          â•²
                 æ˜¯            å¦
                 â”‚              â”‚
                 â”‚              â–¼
                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚    â”‚ æ³¨å…¥éªŒè¯åé¦ˆ         â”‚
                 â”‚    â”‚ retryCount++         â”‚
                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚              â”‚
                 â”‚    retryCount > maxRetriesï¼Ÿ
                 â”‚        â•±          â•²
                 â”‚      å¦            æ˜¯
                 â”‚      â”‚             â”‚
                 â”‚      â””â”€â”€â”€â”€â”€â”       â”‚
                 â”‚            â”‚       â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. æå–å¹¶åˆ›å»ºè®°å¿†ï¼ˆå¦‚æœå¯ç”¨ï¼‰                               â”‚
â”‚     â”œâ”€ AIåˆ†æå†…å®¹ï¼Œæå–å…³é”®äº‹ä»¶                             â”‚
â”‚     â”œâ”€ è§£ææå–ç»“æœ                                          â”‚
â”‚     â””â”€ åˆ›å»ºCharacterMemoryå¹¶ä¿å­˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. è¿”å›GenerationResult                                     â”‚
â”‚     â”œâ”€ ç”Ÿæˆå†…å®¹                                              â”‚
â”‚     â”œâ”€ éªŒè¯ç»“æœ                                              â”‚
â”‚     â”œâ”€ æ–°å»ºè®°å¿†ID                                            â”‚
â”‚     â”œâ”€ ç»Ÿè®¡ä¿¡æ¯                                              â”‚
â”‚     â””â”€ å®Œæ•´æ—¥å¿—                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. è®°å¿†ç®¡ç†

**ä¸ºè§’è‰²æ·»åŠ åˆå§‹è®°å¿†**:
```bash
# ä½¿ç”¨ç°æœ‰çš„ CharacterMemory API
POST /api/character-memories
{
  "characterId": "uuid",
  "memoryType": "æ ¸å¿ƒè®°å¿†",
  "memoryContent": "ä»å°åœ¨å­¤å„¿é™¢é•¿å¤§ï¼Œæ¸´æœ›å®¶åº­æ¸©æš–",
  "emotionalWeight": 0.9,
  "keywords": ["å­¤å„¿é™¢", "ç«¥å¹´", "å­¤ç‹¬", "æ¸´æœ›"]
}
```

**å®šæœŸæ£€ç´¢é‡è¦è®°å¿†**:
```bash
GET /api/character-memories/important/{characterId}?limit=10
```

### 2. ç”Ÿæˆç­–ç•¥

**ç« èŠ‚ç”Ÿæˆæ¨èé…ç½®**:
- temperature: 0.8 (å¹³è¡¡åˆ›æ„å’Œè¿è´¯æ€§)
- maxTokens: 2000-3000
- memoryCount: 5-8
- enableConsistencyCheck: true
- maxRetries: 2

**å¯¹è¯ç”Ÿæˆæ¨èé…ç½®**:
- temperature: 0.9 (æ›´è‡ªç„¶çš„å¯¹è¯)
- maxTokens: 1000-1500
- memoryCount: 3-5
- enableConsistencyCheck: true

**åœºæ™¯æå†™æ¨èé…ç½®**:
- temperature: 0.85
- maxTokens: 1500
- enableMemory: false (åœºæ™¯é€šå¸¸ä¸éœ€è¦è®°å¿†)
- enableConsistencyCheck: true (ä¸»è¦éªŒè¯ä¸–ç•Œè§‚)

### 3. ä¸€è‡´æ€§éªŒè¯

**éªŒè¯é˜ˆå€¼**:
- 0.9+ : ä¼˜ç§€ï¼Œå®Œå…¨ç¬¦åˆè®¾å®š
- 0.7-0.9 : è‰¯å¥½ï¼Œå¯ä»¥æ¥å—
- 0.5-0.7 : ä¸€èˆ¬ï¼Œå»ºè®®é‡è¯•
- <0.5 : è¾ƒå·®ï¼Œå¿…é¡»é‡è¯•

**å¤„ç†éªŒè¯å¤±è´¥**:
1. æ£€æŸ¥ `violations` åˆ—è¡¨ï¼Œäº†è§£å…·ä½“é—®é¢˜
2. æŸ¥çœ‹ `aiSuggestions` è·å–AIçš„ä¿®æ”¹å»ºè®®
3. å¦‚æœæ˜¯ç³»ç»Ÿæ€§é—®é¢˜ï¼Œè€ƒè™‘è°ƒæ•´è§’è‰²è®¾å®šæˆ–ä¸–ç•Œè§‚è§„åˆ™
4. å¢åŠ  `maxRetries` æ¬¡æ•°

### 4. æ€§èƒ½ä¼˜åŒ–

**å‡å°‘å»¶è¿Ÿ**:
- å¿«é€Ÿæµ‹è¯•æ—¶å…³é—­éªŒè¯å’Œè®°å¿†
- å‡å°‘ `memoryCount` å‚æ•°
- é™ä½ `maxTokens`

**æé«˜è´¨é‡**:
- ä¸ºè§’è‰²æ·»åŠ è¯¦ç»†çš„åˆå§‹è®°å¿†
- å®Œå–„è§’è‰²çš„ `speechPattern` å’Œ `behavioralHabits`
- ä¸°å¯Œä¸–ç•Œè§‚çš„ `rules` å’Œ `constraints`

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç”Ÿæˆå†…å®¹ä¸ç¬¦åˆè§’è‰²æ€§æ ¼

**å¯èƒ½åŸå› **:
- è§’è‰²è®¾å®šä¸å¤Ÿè¯¦ç»†
- ç›¸å…³è®°å¿†ä¸è¶³
- AIæ¸©åº¦å‚æ•°è¿‡é«˜

**è§£å†³æ–¹æ¡ˆ**:
1. å®Œå–„è§’è‰²çš„ `personalityTraits`ã€`speechPattern`
2. ä¸ºè§’è‰²æ·»åŠ æ›´å¤šåˆå§‹è®°å¿†
3. é™ä½ `temperature` å‚æ•°ï¼ˆ0.7-0.8ï¼‰
4. å¢åŠ  `maxRetries` ç¡®ä¿éªŒè¯é€šè¿‡

### é—®é¢˜ 2: éªŒè¯æ€»æ˜¯å¤±è´¥

**å¯èƒ½åŸå› **:
- éªŒè¯è§„åˆ™è¿‡äºä¸¥æ ¼
- è§’è‰²è®¾å®šçŸ›ç›¾
- ä¸–ç•Œè§‚è§„åˆ™å†²çª

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `violations` åˆ—è¡¨
2. æŸ¥çœ‹ `aiSuggestions` äº†è§£AIå»ºè®®
3. è°ƒæ•´è§’è‰²è®¾å®šæˆ–ä¸–ç•Œè§‚è§„åˆ™
4. å¦‚æœæ˜¯è¾¹ç¼˜æƒ…å†µï¼Œå¯ä»¥é™ä½éªŒè¯é˜ˆå€¼

### é—®é¢˜ 3: è®°å¿†åˆ›å»ºå¤±è´¥

**å¯èƒ½åŸå› **:
- AIå“åº”æ ¼å¼ä¸ç¬¦åˆé¢„æœŸ
- åœºæ™¯æè¿°ä¸å¤Ÿå…·ä½“
- è§’è‰²ä¿¡æ¯ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**:
1. æŸ¥çœ‹æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
2. ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨é™çº§æ–¹æ¡ˆï¼ˆåˆ›å»ºç®€å•è®°å¿†ï¼‰
3. æ‰‹åŠ¨åˆ›å»ºè®°å¿†è¡¥å……

### é—®é¢˜ 4: ç”Ÿæˆé€Ÿåº¦æ…¢

**å¯èƒ½åŸå› **:
- æ£€ç´¢è®°å¿†è¿‡å¤š
- Tokenæ•°é‡è¿‡å¤§
- å¤šæ¬¡é‡è¯•

**è§£å†³æ–¹æ¡ˆ**:
1. å‡å°‘ `memoryCount` å‚æ•°
2. é™ä½ `maxTokens`
3. å¿«é€Ÿæµ‹è¯•æ—¶å…³é—­éªŒè¯ï¼ˆ`enableConsistencyCheck: false`ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API_STRUCTURE.md](./API_STRUCTURE.md) - APIè¯¦ç»†è¯´æ˜
- [enhanced_feature_modules.md](./enhanced_feature_modules.md) - åŠŸèƒ½æ¨¡å—è®¾è®¡
- [spring_ai_prompt_engineering.md](./spring_ai_prompt_engineering.md) - AIé›†æˆæŒ‡å—
- [CLAUDE.md](../CLAUDE.md) - é¡¹ç›®æ€»ä½“è¯´æ˜

---

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

### Phase 4: æ•…äº‹ç”Ÿæˆæ ¸å¿ƒï¼ˆç¬¬4å‘¨ï¼‰
- ç« èŠ‚ç”Ÿæˆç³»ç»Ÿ
- å¯¹è¯ç”Ÿæˆç³»ç»Ÿ
- è´¨é‡è¯„ä¼°ç³»ç»Ÿ
- å¯¼å‡ºåŠŸèƒ½

### Phase 5: å‰ç«¯å®Œå–„ï¼ˆç¬¬5å‘¨ï¼‰
- Vueç»„ä»¶å¼€å‘
- çŠ¶æ€ç®¡ç†ä¼˜åŒ–
- å®æ—¶ç”Ÿæˆå±•ç¤º
- è®°å¿†å¯è§†åŒ–

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-29
**ç‰ˆæœ¬**: 1.0.0
**ä½œè€…**: StoryForge Team
