# æ—¶é—´çº¿ç³»ç»Ÿå®ç°æ€»ç»“

## âœ… å·²å®Œæˆç»„ä»¶

### 1. TimelineEventType æšä¸¾ï¼ˆ209è¡Œï¼‰
- 17ç§äº‹ä»¶ç±»å‹ï¼ˆå¯¹è¯ã€è¡ŒåŠ¨ã€å†…å¿ƒå˜åŒ–ã€ç¯å¢ƒå˜åŒ–ã€å†²çªã€å‘ç°ã€å†³å®šã€è½¬æŠ˜ã€æˆé•¿ã€å¤±å»ã€è·å¾—ã€ç›¸é‡ã€åˆ†ç¦»ã€å±æœºã€é«˜æ½®ã€è§£å†³ã€å…¶ä»–ï¼‰
- æ¯ç§ç±»å‹åŒ…å«ï¼šä»£ç ã€æ˜¾ç¤ºåç§°ã€æè¿°ã€æ¨èé‡è¦åº¦
- è¾…åŠ©æ–¹æ³•ï¼š
  - `isKeyEvent()` - åˆ¤æ–­æ˜¯å¦ä¸ºå…³é”®äº‹ä»¶
  - `isCharacterEvent()` - åˆ¤æ–­æ˜¯å¦ä¸ºè§’è‰²äº‹ä»¶
  - `isPlotEvent()` - åˆ¤æ–­æ˜¯å¦ä¸ºæƒ…èŠ‚äº‹ä»¶
  - `getRecommendedImportance()` - è·å–æ¨èé‡è¦åº¦ï¼ˆ1-10ï¼‰

### 2. TimelineDTO å¢å¼º
- æ·»åŠ  `@Builder` æ³¨è§£æ”¯æŒ
- æ·»åŠ  `getSimpleSummary()` æ–¹æ³•ç”¨äºç®€è¦å±•ç¤º

### 3. TimelineService å¢å¼ºï¼ˆ~325è¡Œï¼‰
**æ–°å¢é¡¹ç›®çº§åˆ«æ—¶é—´çº¿ç®¡ç†æ–¹æ³•**ï¼š
- `getCompleteProjectTimeline()` - è·å–é¡¹ç›®å®Œæ•´æ—¶é—´çº¿
- `getKeyEvents()` - è·å–å…³é”®äº‹ä»¶ï¼ˆå¯è®¾ç½®é‡è¦åº¦é˜ˆå€¼ï¼‰
- `getEventsByType()` - æŒ‰ç±»å‹è·å–äº‹ä»¶
- `batchCreateTimelines()` - æ‰¹é‡åˆ›å»ºäº‹ä»¶
- `addEventFromScene()` - ä»åœºæ™¯æè¿°åˆ›å»ºäº‹ä»¶

### 4. TimelineController å¢å¼ºï¼ˆ~390è¡Œï¼‰
**åŸæœ‰åŸºç¡€ç«¯ç‚¹**ï¼š
- GET `/api/timelines` - è·å–æ‰€æœ‰æ—¶é—´çº¿
- GET `/api/timelines/{id}` - è·å–å•ä¸ªäº‹ä»¶
- GET `/api/timelines/project/{projectId}` - è·å–é¡¹ç›®æ—¶é—´çº¿
- GET `/api/timelines/character/{characterId}` - è·å–è§’è‰²æ—¶é—´çº¿
- POST `/api/timelines` - åˆ›å»ºæ—¶é—´çº¿äº‹ä»¶
- PUT `/api/timelines/{id}` - æ›´æ–°äº‹ä»¶
- DELETE `/api/timelines/{id}` - åˆ é™¤äº‹ä»¶

**æ–°å¢é¡¹ç›®ç®¡ç†ç«¯ç‚¹**ï¼š
- GET `/api/timelines/project/{projectId}/complete` - å®Œæ•´é¡¹ç›®æ—¶é—´çº¿
- GET `/api/timelines/project/{projectId}/key-events?threshold=7` - å…³é”®äº‹ä»¶
- GET `/api/timelines/project/{projectId}/by-type/{eventType}` - æŒ‰ç±»å‹ç­›é€‰
- POST `/api/timelines/batch` - æ‰¹é‡åˆ›å»ºï¼ˆæœ€å¤š50ä¸ªï¼‰
- POST `/api/timelines/from-scene` - ä»åœºæ™¯æè¿°åˆ›å»ºäº‹ä»¶

**æ–°å¢è¾…åŠ©ç«¯ç‚¹**ï¼š
- GET `/api/timelines/event-types` - è·å–æ‰€æœ‰äº‹ä»¶ç±»å‹
- GET `/api/timelines/event-types/{code}` - è·å–äº‹ä»¶ç±»å‹è¯¦æƒ…
- GET `/api/timelines/suggestions?eventType=turning_point` - è·å–åˆ›å»ºå»ºè®®

### 5. åœºæ™¯ä¸æ—¶é—´çº¿é›†æˆï¼ˆSceneGenerationService ~260è¡Œæ–°å¢ï¼‰
**è‡ªåŠ¨é›†æˆåŠŸèƒ½**ï¼š
- `extractAndCreateTimelineEvents()` - åœºæ™¯ç”Ÿæˆæ—¶è‡ªåŠ¨æå–äº‹ä»¶
- åœºæ™¯ç±»å‹åˆ°äº‹ä»¶ç±»å‹çš„æ™ºèƒ½æ˜ å°„
- åŸºäºå¤šç»´åº¦çš„è®°å¿†é‡è¦åº¦è®¡ç®—
- ä¸ºæ¯ä¸ªå‚ä¸è§’è‰²è‡ªåŠ¨åˆ›å»ºäº‹ä»¶

**æ‰‹åŠ¨æå–åŠŸèƒ½**ï¼š
- `extractTimelineEventFromExistingScene()` - ä¸ºå·²å­˜åœ¨åœºæ™¯æå–äº‹ä»¶
- ä»åœºæ™¯å†…å®¹æ¨æ–­äº‹ä»¶ç±»å‹
- ä»åœºæ™¯æƒ…ç»ªæ¨æ–­è®°å¿†é‡è¦åº¦

**æ–°å¢APIç«¯ç‚¹ï¼ˆSceneGenerationControllerï¼‰**ï¼š
- POST `/api/scenes/{sceneId}/extract-timeline-event` - æ‰‹åŠ¨æå–äº‹ä»¶

---

## ğŸ¯ æ ¸å¿ƒæ¶æ„è®¾è®¡

### æ—¶é—´çº¿æ¨¡å‹
- **ä¸€ä¸ªé¡¹ç›® = ä¸€æ¡æ—¶é—´çº¿**
- Timeline å®ä½“çš„æ¯æ¡è®°å½• = æ—¶é—´çº¿ä¸Šçš„ä¸€ä¸ªäº‹ä»¶
- äº‹ä»¶æŒ‰ `eventTime` æ’åºæ„æˆå®Œæ•´æ—¶é—´çº¿

### äº‹ä»¶ç±»å‹å±‚æ¬¡
```
17ç§äº‹ä»¶ç±»å‹
â”œâ”€ å…³é”®äº‹ä»¶ (5ç§): è½¬æŠ˜ã€é«˜æ½®ã€å±æœºã€å†³å®šã€å‘ç°
â”œâ”€ è§’è‰²äº‹ä»¶ (6ç§): æˆé•¿ã€å†…å¿ƒå˜åŒ–ã€ç›¸é‡ã€åˆ†ç¦»ã€å¤±å»ã€è·å¾—
â””â”€ æƒ…èŠ‚äº‹ä»¶ (5ç§): è¡ŒåŠ¨ã€å†²çªã€å‘ç°ã€å†³å®šã€è§£å†³
```

### åœºæ™¯â†’æ—¶é—´çº¿æ˜ å°„
| åœºæ™¯ç±»å‹ | äº‹ä»¶ç±»å‹ | æ¨èé‡è¦åº¦ |
|---------|---------|-----------|
| ACTION | action | 6 |
| DIALOGUE | dialogue | 6 |
| EMOTIONAL | inner_change | 7 |
| CONFLICT | conflict | 8 |
| CLIMAX | climax | 9 |
| TRANSITION | environment_change | 5 |
| OPENING | encounter | 7 |
| ENDING | resolution | 7 |

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| ç»„ä»¶ | æ–‡ä»¶ | æ–°å¢/ä¿®æ”¹è¡Œæ•° |
|------|------|-------------|
| TimelineEventType | TimelineEventType.java | 209ï¼ˆæ–°å¢ï¼‰|
| TimelineDTO | TimelineDTO.java | +10ï¼ˆä¿®æ”¹ï¼‰|
| TimelineService | TimelineService.java | +105ï¼ˆæ–°å¢æ–¹æ³•ï¼‰|
| TimelineController | TimelineController.java | +245ï¼ˆæ–°å¢ç«¯ç‚¹ï¼‰|
| SceneGenerationService | SceneGenerationService.java | +260ï¼ˆé›†æˆé€»è¾‘ï¼‰|
| SceneGenerationController | SceneGenerationController.java | +30ï¼ˆæ–°ç«¯ç‚¹ï¼‰|
| **æ€»è®¡** | **6ä¸ªæ–‡ä»¶** | **~860è¡Œ** |

---

## ğŸ”Œ REST API ä½¿ç”¨ç¤ºä¾‹

### 1. è·å–é¡¹ç›®å®Œæ•´æ—¶é—´çº¿
```bash
GET /api/timelines/project/{projectId}/complete

å“åº”ï¼š
{
  "code": 200,
  "message": "æˆåŠŸè·å–é¡¹ç›®æ—¶é—´çº¿ï¼Œå…± 15 ä¸ªäº‹ä»¶",
  "data": [
    {
      "id": "...",
      "projectId": "...",
      "characterId": "...",
      "eventTime": "2024-01-15T10:30:00",
      "relativeTime": "ä¸‰å¹´å‰",
      "eventType": "encounter",
      "eventDescription": "åœ¨å’–å•¡é¦†çš„åˆåï¼Œé¦–æ¬¡ç›¸é‡",
      "memoryImportance": 7,
      ...
    },
    ...
  ]
}
```

### 2. è·å–å…³é”®äº‹ä»¶
```bash
GET /api/timelines/project/{projectId}/key-events?threshold=8

å“åº”ï¼šè¿”å›é‡è¦åº¦â‰¥8çš„å…³é”®äº‹ä»¶
```

### 3. æ‰¹é‡åˆ›å»ºäº‹ä»¶
```bash
POST /api/timelines/batch
Content-Type: application/json

[
  {
    "projectId": "...",
    "characterId": "...",
    "eventType": "conflict",
    "eventDescription": "ä¸å®ˆå«å‘ç”Ÿå†²çª",
    "memoryImportance": 8
  },
  {
    "projectId": "...",
    "characterId": "...",
    "eventType": "discovery",
    "eventDescription": "å‘ç°äº†å¯†å®¤",
    "memoryImportance": 9
  }
]
```

### 4. ä»åœºæ™¯è‡ªåŠ¨åˆ›å»ºäº‹ä»¶
```bash
POST /api/timelines/from-scene
Content-Type: application/json

{
  "projectId": "...",
  "characterId": "...",
  "sceneDescription": "åœ¨åºŸå¼ƒå·¥å‚çš„æ·±å¤œï¼Œä¸»è§’å‘ç°äº†çœŸç›¸",
  "eventType": "discovery",
  "memoryImportance": 9
}
```

### 5. åœºæ™¯ç”Ÿæˆæ—¶è‡ªåŠ¨æå–äº‹ä»¶
```bash
POST /api/scenes/generate
Content-Type: application/json

{
  "projectId": "...",
  "sceneType": "CONFLICT",
  "location": "åºŸå¼ƒå·¥å‚",
  "mood": "ç´§å¼ ",
  "characterIds": ["char-id-1", "char-id-2"],
  "extractTimelineEvents": true,  // é»˜è®¤ä¸ºtrue
  ...
}

# åœºæ™¯ç”Ÿæˆå®Œæˆåï¼Œè‡ªåŠ¨ä¸ºæ¯ä¸ªå‚ä¸è§’è‰²åˆ›å»ºæ—¶é—´çº¿äº‹ä»¶
```

### 6. ä¸ºå·²æœ‰åœºæ™¯æ‰‹åŠ¨æå–äº‹ä»¶
```bash
POST /api/scenes/{sceneId}/extract-timeline-event
Content-Type: application/json

{
  "characterId": "...",
  "eventType": "conflict"  // å¯é€‰ï¼Œä¸æä¾›åˆ™è‡ªåŠ¨æ¨æ–­
}
```

### 7. è·å–äº‹ä»¶ç±»å‹åˆ—è¡¨
```bash
GET /api/timelines/event-types

å“åº”ï¼š
{
  "code": 200,
  "data": [
    {
      "code": "turning_point",
      "displayName": "è½¬æŠ˜",
      "description": "æ•…äº‹å‘å±•æ–¹å‘çš„é‡å¤§è½¬å˜",
      "isKeyEvent": true,
      "isCharacterEvent": false,
      "isPlotEvent": false,
      "recommendedImportance": 9
    },
    ...
  ]
}
```

### 8. è·å–åˆ›å»ºå»ºè®®
```bash
GET /api/timelines/suggestions?eventType=climax

å“åº”ï¼š
{
  "code": 200,
  "data": {
    "eventType": "é«˜æ½®",
    "description": "æ•…äº‹æƒ…èŠ‚çš„æœ€é«˜å³°",
    "recommendedImportance": 10,
    "tips": [
      "è¿™æ˜¯å…³é”®äº‹ä»¶ï¼Œå»ºè®®è®¾ç½®è¾ƒé«˜çš„è®°å¿†é‡è¦åº¦ï¼ˆ7-10ï¼‰",
      "å…³é”®äº‹ä»¶åº”è¯¥å¯¹æ•…äº‹å‘å±•äº§ç”Ÿé‡å¤§å½±å“"
    ],
    "generalTips": [
      "å…³é”®äº‹ä»¶ï¼ˆè½¬æŠ˜ã€é«˜æ½®ã€å±æœºç­‰ï¼‰é‡è¦åº¦å»ºè®®8-10",
      "è§’è‰²æˆé•¿ã€å†…å¿ƒå˜åŒ–ç­‰äº‹ä»¶é‡è¦åº¦å»ºè®®4-7",
      ...
    ]
  }
}
```

---

## ğŸ”§ æ ¸å¿ƒç‰¹æ€§

### 1. æ™ºèƒ½äº‹ä»¶æå–
- **è‡ªåŠ¨æ˜ å°„**ï¼šåœºæ™¯ç±»å‹ â†’ äº‹ä»¶ç±»å‹
- **å¤šç»´åº¦è®¡ç®—**ï¼šåŸºäºåœºæ™¯ç±»å‹ã€æƒ…æ„Ÿå¼ºåº¦ã€å…³é”®äº‹ä»¶è‡ªåŠ¨è®¡ç®—é‡è¦åº¦
- **æ‰¹é‡å¤„ç†**ï¼šä¸ºæ¯ä¸ªå‚ä¸è§’è‰²è‡ªåŠ¨åˆ›å»ºäº‹ä»¶

### 2. çµæ´»çš„é‡è¦åº¦ç³»ç»Ÿ
```
è®°å¿†é‡è¦åº¦è®¡ç®—å…¬å¼ï¼š
åŸºç¡€åˆ†(5)
+ åœºæ™¯ç±»å‹åŠ åˆ†(0-4)
+ æƒ…æ„Ÿå¼ºåº¦åŠ åˆ†(0-1)
+ å…³é”®äº‹ä»¶åŠ åˆ†(0-1)
+ å†²çªç‚¹åŠ åˆ†(0-1)
= æœ€ç»ˆé‡è¦åº¦(1-10)
```

### 3. å®Œæ•´çš„é¡¹ç›®æ—¶é—´çº¿è§†å›¾
- åˆå¹¶æ‰€æœ‰è§’è‰²äº‹ä»¶
- æŒ‰æ—¶é—´æ’åº
- æ”¯æŒç­›é€‰ï¼ˆç±»å‹ã€é‡è¦åº¦ï¼‰

### 4. äº‹ä»¶ç±»å‹åˆ†ç±»
- **å…³é”®äº‹ä»¶**ï¼šå½±å“æ•…äº‹èµ°å‘
- **è§’è‰²äº‹ä»¶**ï¼šå½±å“è§’è‰²æˆé•¿
- **æƒ…èŠ‚äº‹ä»¶**ï¼šæ¨è¿›æ•…äº‹æƒ…èŠ‚

---

## âœ… SQLå˜æ›´

**æ— éœ€SQLå˜æ›´** âœ“
ä½¿ç”¨ç°æœ‰Timelineå®ä½“ç»“æ„ï¼Œæ¯æ¡è®°å½•ä»£è¡¨ä¸€ä¸ªäº‹ä»¶ã€‚

---

## ğŸš€ ä½¿ç”¨å»ºè®®

### äº‹ä»¶é‡è¦åº¦å‚è€ƒ
| äº‹ä»¶ç±»å‹ | æ¨èé‡è¦åº¦ | è¯´æ˜ |
|---------|-----------|------|
| é«˜æ½® | 10 | æ•…äº‹æœ€é«˜å³° |
| è½¬æŠ˜ã€å±æœº | 9 | é‡å¤§è½¬å˜ |
| å†³å®šã€å‘ç°ã€å¤±å» | 8 | å…³é”®äº‹ä»¶ |
| æˆé•¿ã€è·å¾— | 7 | è§’è‰²å‘å±• |
| å†²çªã€è§£å†³ | 6 | æƒ…èŠ‚æ¨è¿› |
| ç›¸é‡ã€åˆ†ç¦» | 5 | å…³ç³»å˜åŒ– |
| å†…å¿ƒå˜åŒ– | 4 | æƒ…æ„Ÿæ³¢åŠ¨ |
| è¡ŒåŠ¨ã€å¯¹è¯ | 3 | æ—¥å¸¸äº’åŠ¨ |
| ç¯å¢ƒå˜åŒ– | 2 | èƒŒæ™¯æè¿° |
| å…¶ä»– | 1 | çç¢äº‹ä»¶ |

### åœºæ™¯ç”Ÿæˆæœ€ä½³å®è·µ
1. **å¯ç”¨è‡ªåŠ¨æå–**ï¼šè®¾ç½® `extractTimelineEvents: true`
2. **æŒ‡å®šå‚ä¸è§’è‰²**ï¼šç¡®ä¿ `characterIds` åŒ…å«æ‰€æœ‰å…³é”®è§’è‰²
3. **æä¾›åœºæ™¯ç›®çš„**ï¼šè®¾ç½® `scenePurpose` å¸®åŠ©ç”Ÿæˆæ›´å‡†ç¡®çš„äº‹ä»¶æè¿°
4. **å…³é”®äº‹ä»¶åˆ—è¡¨**ï¼šé€šè¿‡ `keyEvents` æ˜ç¡®é‡è¦äº‹ä»¶

### æ—¶é—´çº¿ç®¡ç†å»ºè®®
- å…³é”®äº‹ä»¶é˜ˆå€¼å»ºè®®è®¾ä¸º7-8
- æ‰¹é‡åˆ›å»ºé™åˆ¶åœ¨50ä¸ªä»¥å†…
- ä¸ºé‡è¦åœºæ™¯æ‰‹åŠ¨è¡¥å……æ—¶é—´çº¿äº‹ä»¶
- å®šæœŸæ£€æŸ¥é¡¹ç›®å®Œæ•´æ—¶é—´çº¿ç¡®ä¿è¿è´¯æ€§

---

## ğŸ”— é›†æˆå…³ç³»

```
é¡¹ç›®æ—¶é—´çº¿ç³»ç»Ÿé›†æˆæ¶æ„ï¼š

SceneGenerationService
    â†“ (è‡ªåŠ¨æå–)
TimelineService
    â†“ (åˆ›å»ºäº‹ä»¶)
Timeline Entity
    â†“ (å…³è”)
Character & Project

æŸ¥è¯¢æµç¨‹ï¼š
TimelineController
    â†“
TimelineService
    â”œâ”€ å®Œæ•´æ—¶é—´çº¿æŸ¥è¯¢
    â”œâ”€ å…³é”®äº‹ä»¶ç­›é€‰
    â”œâ”€ ç±»å‹ç­›é€‰
    â””â”€ è®°å¿†æ£€ç´¢æ”¯æŒ
```

---

## ğŸ“ ä¸‹ä¸€æ­¥æ‰©å±•ï¼ˆå¯é€‰ï¼‰

1. **AIè¾…åŠ©äº‹ä»¶æå–**ï¼šä½¿ç”¨AIåˆ†æåœºæ™¯å†…å®¹ï¼Œæ™ºèƒ½æå–å¤šä¸ªç»†ç²’åº¦äº‹ä»¶
2. **äº‹ä»¶å…³è”åˆ†æ**ï¼šåˆ†æäº‹ä»¶é—´çš„å› æœå…³ç³»
3. **æ—¶é—´çº¿å¯è§†åŒ–**ï¼šç”Ÿæˆæ—¶é—´çº¿å›¾è¡¨
4. **å†²çªæ£€æµ‹**ï¼šæ£€æµ‹æ—¶é—´çº¿ä¸Šçš„é€»è¾‘å†²çª

---

**æ—¶é—´çº¿ç³»ç»Ÿå®ç°å®Œæˆ** âœ…
**æ— éœ€SQLå˜æ›´** âœ“
**å·²å®Œå…¨é›†æˆåœºæ™¯ç”Ÿæˆç³»ç»Ÿ** âœ“
